<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sign In</title>
    <link type="text/css" rel="stylesheet" href="/static/main.css">
    <link rel="icon" type="image/ico" href="/static/favicon.ico">
</head>
    <body>
        <form id="signin-form">
            Email: <input type="email" id="signin-email" required/><br>
            Password: <input type="password" id="signin-password" required/><input type="checkbox" id="sishow">Show Password<br>
            <button>Sign In</button><br>
            <a id="forgot">Forgot Password?</a>
        </form><br>
        <button type="button" id="sigoogle">Sign In With Google</button>
        
        <script src="https://www.gstatic.com/firebasejs/6.4.2/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/6.4.2/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/6.4.2/firebase-firestore.js"></script>

        <script>
          // Your web app's Firebase configuration
          var firebaseConfig = {
            apiKey: "AIzaSyAiJ7LaeIdYVkYjITeD7n7l8tlhtBwbEcs",
            authDomain: "gpa-calculat.firebaseapp.com",
            databaseURL: "https://gpa-calculat.firebaseio.com",
            projectId: "gpa-calculat",
            storageBucket: "",
            messagingSenderId: "759808162504",
            appId: "1:759808162504:web:05dbfe6b6274801f"
          };
          // Initialize Firebase
          firebase.initializeApp(firebaseConfig);
          
          const auth = firebase.auth();
          const db = firebase.firestore();
          
        </script>
        <script src="/scripts/main.js"></script>
        <script src="/scripts/firbase_communication.js"></script>
        <script src="/scripts/redirects.js"></script>
        <script>
          var done = false;
          //signin
          const signinForm = document.querySelector("#signin-form");
          signinForm.addEventListener("submit", (e) => {
              e.preventDefault();
              const email =  signinForm["signin-email"].value;
              const password = signinForm["signin-password"].value;
              auth.signInWithEmailAndPassword(email, password).then((cred) => {
                  signinForm.reset();
                  if (cred.user.emailVerified) {
                    window.location.href = parseURLParams(window.location.href).redirect[0];
                  } else {
                    window.location.href = "/htmls/verify.html"
                  }
              }).catch(function(error){
                  var errorMessage = error.message;
                  window.alert(errorMessage);
                  console.log(error);
              });
          });
          
          var done = false;
          var provider = new firebase.auth.GoogleAuthProvider();
          firebase.auth().getRedirectResult().then(function(result) {
            if (result.credential) {
              var token = result.credential.accessToken;
            }
            if (result.user) {
              var user = result.user;
              window.location.href = parseURLParams(window.location.href).redirect[0];
            }
          }).catch(function(error) {
            console.error(error);
            window.alert("Your sign in didn't work. Please try again.")
          });
        </script>
    </body>
</html>

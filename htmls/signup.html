<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sign Up</title>
    <link type="text/css" rel="stylesheet" href="/static/main.css">
    <link rel="icon" type="image/ico" href="/static/favicon.ico">
</head>
    <body>
        <form id="signup-form">
            Name: <input type="text" id="name" required/><br>
            Email: <input type="email" id="signup-email" required/><br>
            Password: <input type="password" id="signup-password" required/><input type="checkbox" id="sushow">Show Password<br>
            <button>Sign Up</button>
        </form>
        <button type="button" id="sugoogle">Sign Up with Google</button>
        
        <script src="https://www.gstatic.com/firebasejs/6.4.2/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/6.4.2/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/6.4.2/firebase-firestore.js"></script>
        
        <script>
          // Your web app's Firebase configuration
          var firebaseConfig = {
            apiKey: "AIzaSyAiJ7LaeIdYVkYjITeD7n7l8tlhtBwbEcs",
            authDomain: "gpa-calculat.firebaseapp.com",
            databaseURL: "https://gpa-calculat.firebaseio.com",
            projectId: "gpa-calculat",
            storageBucket: "",
            messagingSenderId: "759808162504",
            appId: "1:759808162504:web:05dbfe6b6274801f"
          };
          // Initialize Firebase
          firebase.initializeApp(firebaseConfig);
          
          const auth = firebase.auth();
          const db = firebase.firestore();
          
        </script>
        <script src="/scripts/main.js"></script>
        <script src="/scripts/firbase_communication.js"></script>
        <script src="/scripts/redirects.js"></script>
        <script>
          //signup
          const signupForm = document.querySelector("#signup-form");
          signupForm.addEventListener("submit", (e) => {
              e.preventDefault();
              const name = signupForm["name"].value;
              const email =  signupForm["signup-email"].value;
              const password = signupForm["signup-password"].value;
              auth.createUserWithEmailAndPassword(email,password).then(cred => {
                  var user = auth.currentUser;
                  user.updateProfile({
                    displayName: name
                  }).then(()=>{
                    user.sendEmailVerification(actionCodeSettings).then(function() {
                      window.location.href = "/htmls/setup.html";
                    }).catch(function(error) {
                      console.error(error);
                    });
                  });
              }).catch(function(error){
                  var errorMessage = error.message;
                  window.alert(errorMessage);
              });
          });
          
          var provider = new firebase.auth.GoogleAuthProvider();
          firebase.auth().getRedirectResult().then(function(result) {
            if (result.credential) {
              var token = result.credential.accessToken;
            }
            var user = result.user;
            if (result.user) {window.location.href = "/htmls/setup.html"}
          }).catch(function(error) {
            console.error(error);
            window.alert("Your sign up didn't work. Please try again.")
          });
        </script>
    </body>
</html>
